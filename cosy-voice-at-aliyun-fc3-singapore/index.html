<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jimmy TTS Demo</title>
    <!-- Import Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .audio-container {
            margin-top: 20px;
        }
        .chunk-item {
            margin: 10px 0;
            padding: 10px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .status-indicator {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>Jimmy TTS Demo</h1>
            </div>
            
            <el-form @submit.prevent="generateSpeech">
                <el-form-item>
                    <el-input
                        v-model="inputText"
                        type="textarea"
                        :rows="4"
                        :placeholder="'请输入要转换的文字...'"
                        :disabled="isGenerating"
                    ></el-input>
                </el-form-item>
                
                <el-form-item>
                    <el-button 
                        type="primary" 
                        @click="generateSpeech" 
                        :loading="isGenerating"
                        :disabled="!inputText || isGenerating"
                    >
                        {{ isGenerating ? '生成中...' : '生成语音' }}
                    </el-button>
                    <el-button 
                        @click="clearAll" 
                        :disabled="isGenerating || audioChunks.length === 0"
                    >
                        清除所有
                    </el-button>
                    <el-button
                        type="success"
                        @click="generateRandomSentence"
                        :disabled="isGenerating"
                    >
                        生成句子
                    </el-button>
                </el-form-item>
            </el-form>

            <div class="status-indicator" v-if="isGenerating">
                <el-progress type="circle" :percentage="generationProgress"></el-progress>
            </div>

            <div class="audio-container" v-if="audioChunks.length > 0">
                <h3>生成的音频片段:</h3>
                <div class="chunk-item" v-for="chunk in audioChunks" :key="chunk.id">
                    <div>片段 #{{ chunk.id + 1 }}</div>
                    <audio :src="chunk.audioUrl" controls></audio>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Import Element Plus -->
    <script src="https://unpkg.com/element-plus"></script>
    <!-- Import Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    
    <script>
        const { createApp, ref } = Vue;
        const { ElMessage } = ElementPlus;

        const app = createApp({
            setup() {
                const inputText = ref('');
                const isGenerating = ref(false);
                const audioChunks = ref([]);
                const generationProgress = ref(0);
                let ws = null;

                const sentences = [
                    "今天天气晴朗，阳光照耀着大地，让人心情愉悦。",
                    "我最近开始学习烹饪，尝试做一些新的菜肴，感觉很有成就感。",
                    "昨晚我和朋友们一起聚会，聊了很多有趣的事情，笑声不断。",
                    "每当我听到那首歌，就会想起我们一起度过的美好时光。",
                    "最近我迷上了摄影，喜欢用相机记录生活中的点滴瞬间。",
                    "这个周末我们打算去爬山，享受大自然的美丽风景。",
                    "有时候我会在公园里散步，享受清新的空气和宁静的环境。",
                    "我们家附近新开了一家咖啡馆，环境很好，非常适合放松心情。",
                    "昨天我参加了一个有趣的讲座，学到了很多新的知识和见解。",
                    "最近我在看一本关于心理学的书，觉得非常有趣且启发性强。",
                    "每天早上我都会喝一杯咖啡，帮助我提神醒脑，开始新的一天。",
                    "我们计划下个月去海边度假，希望能享受阳光和沙滩的乐趣。",
                    "有时候我会在晚上写日记，把一天的感受和想法记录下来。",
                    "最近我开始练习瑜伽，感觉身心都得到了很好的放松和舒缓。",
                    "昨天我在网上看到一个很有趣的纪录片，立刻就被吸引住了。",
                    "这个冬天特别寒冷，希望能早点迎来温暖的春天。",
                    "我们计划去参加一个音乐节，希望能听到喜欢的乐队现场演出。",
                    "有时候我会在晚上看星星，思考人生中的种种可能性和梦想。",
                    "最近我在尝试写作，希望能把自己的故事分享给更多的人。",
                    "昨晚我做了一个奇怪的梦，醒来后还在思考它的含义是什么。"
                ];

                const generateRandomSentence = () => {
                    const randomIndex = Math.floor(Math.random() * sentences.length);
                    inputText.value = sentences[randomIndex];
                };

                const generateSpeech = () => {
                    if (!inputText.value || isGenerating.value) return;
                    
                    isGenerating.value = true;
                    audioChunks.value = [];
                    generationProgress.value = 0;

                    // Updated WebSocket URL with port 50000
                    ws = new WebSocket('ws://tts.watchfun-intelligence.com:50000/tts');

                    ws.onopen = () => {
                        ws.send(inputText.value);
                    };

                    ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        
                        if (data.error) {
                            ElMessage.error('Error: ' + data.error);
                            isGenerating.value = false;
                            return;
                        }

                        // Create audio URL from base64 data
                        const audioBlob = base64ToBlob(data.audio_data, 'audio/wav');
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        // Add to audio chunks
                        audioChunks.value.push({
                            id: data.chunk_id,
                            audioUrl: audioUrl
                        });

                        // Update progress (assuming approximately 10 chunks total)
                        generationProgress.value = Math.min(Math.round((data.chunk_id + 1) * 10), 100);
                    };

                    ws.onclose = () => {
                        isGenerating.value = false;
                        generationProgress.value = 100;
                    };

                    ws.onerror = (error) => {
                        ElMessage.error('WebSocket error occurred');
                        isGenerating.value = false;
                    };
                };

                const clearAll = () => {
                    // Clean up audio URLs
                    audioChunks.value.forEach(chunk => {
                        URL.revokeObjectURL(chunk.audioUrl);
                    });
                    audioChunks.value = [];
                    generationProgress.value = 0;
                };

                const base64ToBlob = (base64, type) => {
                    const binStr = atob(base64);
                    const len = binStr.length;
                    const arr = new Uint8Array(len);
                    for (let i = 0; i < len; i++) {
                        arr[i] = binStr.charCodeAt(i);
                    }
                    return new Blob([arr], { type: type });
                };

                return {
                    inputText,
                    isGenerating,
                    audioChunks,
                    generationProgress,
                    generateSpeech,
                    clearAll,
                    generateRandomSentence
                };
            }
        });

        app.use(ElementPlus);
        app.mount('#app');
    </script>
</body>
</html> 